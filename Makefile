.PHONY: build switch clean format

define print_banner
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo "> $(1)"
	@echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
	@echo ""
endef

################################################################################
# ๐ System Deployment Commands
################################################################################

build:
	$(call print_banner,๐จ Building system configuration...)
	@nh os build $(if $(HOSTNAME),-H $(HOSTNAME)) .

switch:
	$(call print_banner,โก Applying system configuration...)
	@nh os switch $(if $(HOSTNAME),-H $(HOSTNAME)) .

clean:
	$(call print_banner,๐งน Cleaning up old generations...)
	@nh clean all --keep 3 --keep-since 120h

################################################################################
# ๐จ Code Formatting Commands
################################################################################

format:
	@FILES="${FILES:-$$(find . -name '*.nix')}" && \
	nixfmt $$FILES
